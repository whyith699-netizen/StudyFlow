<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Study Dashboard</title>
    <link rel="stylesheet" href="popup.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        html {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            /* Responsive Full Page (Tab) & Fixed Popup Support */
            width: 100%;
            height: 100%; /* Fill html height */
            min-height: 100vh; /* Ensure at least viewport height */
            min-width: 780px; /* Ensures Popup Bubble size */
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background: white; 
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            overflow: hidden;
            display: flex;
        }

        .login-container {
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: row;
            overflow: hidden;
            position: relative;
            border-radius: 0; /* Remove rounded corners */
            box-shadow: none; /* Remove shadow */
        }

        /* --- LEFT SIDE: VISUAL (Blue) --- */
        .visual-side {
            width: 55%;
            background: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            color: white;
            padding: 24px;
            text-align: center;
            overflow: hidden;
        }

        .bg-circles {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
        }
        .circle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255,255,255,0.05);
        }
        .circle:nth-child(1) { width: 300px; height: 300px; top: -100px; left: -100px; }
        .circle:nth-child(2) { width: 200px; height: 200px; bottom: -50px; right: -50px; }

        .visual-title {
            font-size: 1.6rem;
            font-weight: 800;
            margin: 0 0 12px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            z-index: 10;
        }

        .visual-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.5;
            margin: 0;
            position: relative;
            z-index: 10;
        }

        /* --- RIGHT SIDE: FORM (White) --- */
        .form-side {
            width: 45%;
            background: white;
            padding: 30px 40px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            max-height: 100vh;
            overflow-y: auto;
            box-sizing: border-box;
        }

        /* --- MATH FORMULAS AREA --- */
        .math-formulas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 5;
        }

        .math-formula {
            position: absolute;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 16px;
            padding: 16px 20px;
            color: white;
            font-family: 'Inter', system-ui, sans-serif;
            font-size: 0.85rem;
            cursor: grab;
            pointer-events: auto;
            user-select: none;
            transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-width: 180px;
        }

        .math-formula:hover {
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            transform: scale(1.05);
        }

        .math-formula.dragging {
            cursor: grabbing;
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.2);
            transform: scale(1.08);
            z-index: 100;
        }

        .math-formula .formula-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .math-formula .formula-content {
            font-size: 0.95rem;
            font-weight: 500;
            line-height: 1.4;
        }

        .math-formula .formula-content .symbol {
            font-size: 1.1rem;
        }

        /* Floating animation for formulas */
        @keyframes float1 {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(1deg); }
        }
        @keyframes float2 {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(-1deg); }
        }
        @keyframes float3 {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-8px) rotate(2deg); }
        }
        @keyframes float4 {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-12px) rotate(-2deg); }
        }

        .math-formula:not(.dragging) {
            animation-timing-function: ease-in-out;
            animation-iteration-count: infinite;
        }

        .formula-1 { animation: float1 4s infinite; }
        .formula-2 { animation: float2 5s infinite; }
        .formula-3 { animation: float3 4.5s infinite; }
        .formula-4 { animation: float4 5.5s infinite; }
        .formula-5 { animation: float1 6s infinite; }
        .formula-6 { animation: float2 4.8s infinite; }
        .formula-7 { animation: float3 5.2s infinite; }
        .formula-8 { animation: float4 4.3s infinite; }
        .formula-9 { animation: float1 5.8s infinite; }
        .formula-10 { animation: float2 4.6s infinite; }
        .formula-11 { animation: float3 5.4s infinite; }
        .formula-12 { animation: float4 4.9s infinite; }


        /* --- AUTH ELEMENTS --- */
        .auth-tabs {
            display: flex;
            margin-bottom: 24px;
            background: #F3F4F6;
            border-radius: 12px;
            padding: 4px;
            border: none;
            width: 100%;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            border: none;
            background: transparent;
            color: #6B7280;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .auth-tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .auth-form {
            display: none;
            flex-direction: column;
            gap: 16px;
            width: 100%;
        }

        .auth-form.active {
            display: flex;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #374151;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #E5E7EB;
            border-radius: 10px;
            font-size: 0.95rem;
            background: #F9FAFB;
            color: var(--text);
            transition: all 0.2s;
            box-sizing: border-box;
            font-family: inherit;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn-submit {
            width: 100%;
            padding: 14px;
            font-size: 1rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary) 0%, #1e40af 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
            margin-top: 8px;
            font-family: inherit;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(37, 99, 235, 0.3);
        }

        #google-login-btn {
            background: white;
            color: #4B5563;
            border: 2px solid #E5E7EB;
            margin-bottom: 20px;
            box-shadow: none;
            cursor: pointer;
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 500;
            transition: all 0.2s;
            font-family: inherit;
        }

        #google-login-btn:hover {
            background: #F9FAFB;
            border-color: #D1D5DB;
            transform: translateY(-1px);
        }

        .divider {
            display: flex;
            align-items: center;
            gap: 16px;
            margin: 8px 0 24px;
            color: #9CA3AF;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .divider::before, .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #E5E7EB;
        }

        .auth-message {
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 0.9rem;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
            width: 100%;
            box-sizing: border-box;
        }
        .auth-message.show { display: flex; }
        .auth-message.error { background: #FEF2F2; color: #DC2626; border: 1px solid #FECACA; }
        .auth-message.success { background: #F0FDF4; color: #16A34A; border: 1px solid #BBF7D0; }

        .forgot-password-link {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 12px;
            width: 100%;
            font-weight: 500;
            font-family: inherit;
        }

        .forgot-password-link:hover {
            text-decoration: underline;
        }

        .password-input-wrapper {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #9CA3AF;
            cursor: pointer;
            padding: 4px;
        }
        
        .loading-spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .dark-mode body {
            background: #0f172a;
        }
    </style>
</head>

<body>
    <div class="login-container">
        
        <!-- LEFT: VISUAL SIDE -->
        <div class="visual-side">
            <div class="bg-circles">
                <div class="circle"></div>
                <div class="circle"></div>
            </div>

            <!-- Math Formulas Container -->
            <div class="math-formulas-container" id="mathFormulasContainer">
                <!-- Formula 1: Quadratic Equation -->
                <div class="math-formula formula-1" style="top: 8%; left: 12%;">
                    <div class="formula-label">Quadratic</div>
                    <div class="formula-content"><span class="symbol">x</span> = (-b ± √(b²-4ac)) / 2a</div>
                </div>

                <!-- Formula 2: Pythagorean -->
                <div class="math-formula formula-2" style="top: 15%; right: 15%;">
                    <div class="formula-label">Pythagorean</div>
                    <div class="formula-content"><span class="symbol">a</span>² + <span class="symbol">b</span>² = <span class="symbol">c</span>²</div>
                </div>

                <!-- Formula 3: Euler's Identity -->
                <div class="math-formula formula-3" style="top: 35%; left: 8%;">
                    <div class="formula-label">Euler</div>
                    <div class="formula-content"><span class="symbol">e</span>^(iπ) + 1 = 0</div>
                </div>

                <!-- Formula 4: Derivative -->
                <div class="math-formula formula-4" style="top: 45%; right: 10%;">
                    <div class="formula-label">Derivative</div>
                    <div class="formula-content"><span class="symbol">f'</span>(x) = lim(h→0) [f(x+h)-f(x)]/h</div>
                </div>

                <!-- Formula 5: Integral -->
                <div class="math-formula formula-5" style="top: 62%; left: 15%;">
                    <div class="formula-label">Integral</div>
                    <div class="formula-content">∫<span class="symbol">f</span>(x)dx = <span class="symbol">F</span>(x) + C</div>
                </div>

                <!-- Formula 6: Logarithm -->
                <div class="math-formula formula-6" style="top: 70%; right: 18%;">
                    <div class="formula-label">Logarithm</div>
                    <div class="formula-content">log<span class="symbol">a</span>(x) = ln(x)/ln(a)</div>
                </div>

                <!-- Formula 7: Trigonometry -->
                <div class="math-formula formula-7" style="top: 25%; left: 35%;">
                    <div class="formula-label">Trigonometry</div>
                    <div class="formula-content">sin²<span class="symbol">θ</span> + cos²<span class="symbol">θ</span> = 1</div>
                </div>

                <!-- Formula 8: Area of Circle -->
                <div class="math-formula formula-8" style="top: 55%; left: 40%;">
                    <div class="formula-label">Circle Area</div>
                    <div class="formula-content"><span class="symbol">A</span> = <span class="symbol">π</span>r²</div>
                </div>

                <!-- Formula 9: Einstein -->
                <div class="math-formula formula-9" style="top: 85%; left: 25%;">
                    <div class="formula-label">Einstein</div>
                    <div class="formula-content"><span class="symbol">E</span> = <span class="symbol">mc</span>²</div>
                </div>

                <!-- Formula 10: Binomial -->
                <div class="math-formula formula-10" style="top: 88%; right: 25%;">
                    <div class="formula-label">Binomial</div>
                    <div class="formula-content">(a+b)ⁿ = Σ C(n,k) a^(n-k) b^k</div>
                </div>

                <!-- Formula 11: Limit -->
                <div class="math-formula formula-11" style="top: 5%; left: 55%;">
                    <div class="formula-label">Limit</div>
                    <div class="formula-content">lim(x→∞) (1 + 1/x)^x = <span class="symbol">e</span></div>
                </div>

                <!-- Formula 12: Matrix -->
                <div class="math-formula formula-12" style="top: 78%; left: 5%;">
                    <div class="formula-label">Determinant</div>
                    <div class="formula-content">|A| = a₁₁a₂₂ - a₁₂a₂₁</div>
                </div>
            </div>

        </div>

        <!-- RIGHT: FORM SIDE -->
        <div class="form-side">
            <div id="auth-success" class="auth-message success">
                <i class="fas fa-check-circle"></i>
                <span class="message-text"></span>
            </div>
            <div id="auth-error" class="auth-message error">
                <i class="fas fa-exclamation-circle"></i>
                <span class="message-text"></span>
            </div>

            <!-- Profile View -->
            <div id="profile-view" class="auth-form" style="text-align: center;">
                <div style="font-size: 4rem; color: var(--primary); margin-bottom: 16px;">
                    <i class="fas fa-user-circle"></i>
                </div>
                <h2 id="profile-email" style="font-size: 1.1rem; margin-bottom: 24px; word-break: break-all;"></h2>
                <button id="logout-btn" class="btn-submit" style="background: #e2e8f0; color: #475569;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>

            <!-- Auth Tabs (Login/Register) -->
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Login</button>
                <button class="auth-tab" data-tab="register">Register</button>
            </div>

            <button id="google-login-btn">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" height="18" alt="Google">
                <span>Sign in with Google</span>
            </button>
            
            <div class="divider">or continue with email</div>

            <!-- Login Form -->
            <form id="login-form" class="auth-form active">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="login-email" placeholder="name@email.com" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="login-password" placeholder="Enter password" required>
                        <button type="button" class="password-toggle" data-target="login-password">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <button type="submit" class="btn-submit"><span class="btn-text">Login</span></button>
                <button type="button" id="forgot-password-btn" class="forgot-password-link">Forgot password?</button>
            </form>

            <!-- Register Form -->
            <form id="register-form" class="auth-form">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="register-email" placeholder="name@email.com" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="register-password" placeholder="Min. 6 chars" required minlength="6">
                        <button type="button" class="password-toggle" data-target="register-password">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Confirm Password</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="register-confirm" placeholder="Confirm password" required>
                        <button type="button" class="password-toggle" data-target="register-confirm">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <button type="submit" class="btn-submit"><span class="btn-text">Create Account</span></button>
            </form>
        </div>
    </div>

    <script src="../lib/firebase/firebase-app-compat.js"></script>
    <script src="../lib/firebase/firebase-auth-compat.js"></script>
    <script src="../lib/firebase/firebase-firestore-compat.js"></script>
    <script src="../firebase-config.js"></script>
    <script src="../oauth-config.js"></script>
    <script src="../sync-service.js"></script>
    <script src="login-popup.js"></script>

    <!-- Math Formulas Drag Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const formulas = document.querySelectorAll('.math-formula');
            let draggedFormula = null;
            let offsetX = 0;
            let offsetY = 0;

            formulas.forEach(formula => {
                // Mouse events
                formula.addEventListener('mousedown', startDrag);
                // Touch events
                formula.addEventListener('touchstart', startDrag, { passive: false });
            });

            function startDrag(e) {
                e.preventDefault();
                draggedFormula = e.currentTarget;
                draggedFormula.classList.add('dragging');

                const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
                const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;

                const rect = draggedFormula.getBoundingClientRect();
                offsetX = clientX - rect.left;
                offsetY = clientY - rect.top;

                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchmove', drag, { passive: false });
                document.addEventListener('touchend', stopDrag);
            }

            function drag(e) {
                if (!draggedFormula) return;
                e.preventDefault();

                const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
                const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;

                const container = document.getElementById('mathFormulasContainer');
                const containerRect = container.getBoundingClientRect();

                let newX = clientX - containerRect.left - offsetX;
                let newY = clientY - containerRect.top - offsetY;

                // Keep formula within container bounds
                const formulaRect = draggedFormula.getBoundingClientRect();
                newX = Math.max(0, Math.min(newX, containerRect.width - formulaRect.width));
                newY = Math.max(0, Math.min(newY, containerRect.height - formulaRect.height));

                draggedFormula.style.left = newX + 'px';
                draggedFormula.style.top = newY + 'px';
                draggedFormula.style.right = 'auto';
            }

            function stopDrag() {
                if (draggedFormula) {
                    draggedFormula.classList.remove('dragging');
                    draggedFormula = null;
                }
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchmove', drag);
                document.removeEventListener('touchend', stopDrag);
            }
        });
    </script>
</body>

</html>